# Ritual Rooms ‚Äî –¢–ó –¥–ª—è Codex (MVP Web/PWA)

> ‚ö° –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–ª–µ–Ω—ã wireframes (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã), –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —Å –≤–æ–∑—Ä–∞—Å—Ç–æ–º/–ø–æ–ª–æ–º, –¥—Ä—É–∑—å—è/–∫–æ–Ω—Ç–∞–∫—Ç—ã, ¬´—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –∫–æ–º–Ω–∞—Ç–µ¬ª, –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –ø–æ–¥ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.


> –¶–µ–ª—å: –±—ã—Å—Ç—Ä—ã–π MVP ¬´–∫–æ–º–Ω–∞—Ç—ã-—Ä–∏—Ç—É–∞–ª—ã¬ª —Å —Ä–µ–∞–ª—Ç–∞–π–º–æ–º: –ª–æ–±–±–∏ ‚Üí –∫–æ–º–Ω–∞—Ç–∞ ‚Üí —á–µ–∫-–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Üí XP/—Å—Ç—Ä–∏–∫ ‚Üí –ª–∏–¥–µ—Ä–±–æ—Ä–¥.  
> –ü–æ–¥—Ö–æ–¥: Web-first (Next.js) + PWA. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ data-driven: –Ω–æ–≤—ã–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã/–∫–æ–º–Ω–∞—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏.

---

## 0) Definition of Done (—á—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º)

### MVP-1 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
- –õ–æ–±–±–∏ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∫–æ–º–Ω–∞—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (upcoming/live/finished), —Ç–∞–π–º–µ—Ä –¥–æ —Å—Ç–∞—Ä—Ç–∞.
- –í—Ö–æ–¥ –≤ live-–∫–æ–º–Ω–∞—Ç—É (—Ä–µ–∞–ª—Ç–∞–π–º): —Ç–∞–π–º–µ—Ä, –∞–≤–∞—Ç–∞—Ä–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∫–Ω–æ–ø–∫–∏ +1/+5/+10 –∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥.
- –ü–æ—è–≤–ª—è—é—â–∏–µ—Å—è ¬´–ø–æ–ø–∞–ø—ã¬ª –Ω–∞–¥ –∞–≤–∞—Ç–∞—Ä–æ–º: +5/+10/+20 (–º–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏–∏).
- –û–±—â–∏–π ¬´Raid Counter¬ª –∫–æ–º–Ω–∞—Ç—ã + –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä 1000 reps).
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Ç–∞ ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (reps/minutes) –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ XP.
- –°—Ç—Ä–∏–∫–∏ (daily) + –±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å XP/—É—Ä–æ–≤–Ω–µ–º.
- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ Self (today/week) –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ –∏ –æ–±—â–∏–π.

### MVP-2 (–ø–æ—Å–ª–µ MVP-1)
- Buddy-verify (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–ø–∞—Ä–Ω–∏–∫–æ–º) + Verified –ª–∏–¥–µ—Ä–±–æ—Ä–¥.
- –õ–∏—á–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —à–∞–±–ª–æ–Ω—ã –∫–æ–º–Ω–∞—Ç).
- –ê—á–∏–≤–∫–∏ (10‚Äì15).

---

## 1) Product Loop (–ø–µ—Ç–ª—è —É–¥–µ—Ä–∂–∞–Ω–∏—è)

1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –±–ª–∏–∂–∞–π—à—É—é –∫–æ–º–Ω–∞—Ç—É (–ª–æ–±–±–∏) ‚Üí 2) –∑–∞—Ö–æ–¥–∏—Ç ‚Üí 3) –¥–µ–ª–∞–µ—Ç —Å–µ—Ç –≤–º–µ—Å—Ç–µ ‚Üí 4) —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí 5) –ø–æ–ª—É—á–∞–µ—Ç XP/—Å—Ç—Ä–∏–∫/—Ä–∞–Ω–≥ ‚Üí 6) –≤–∏–¥–∏—Ç —Å–≤–æ—ë –º–µ—Å—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ ‚Üí 7) –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–º–Ω–∞—Ç—ã –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

---

## 2) –†–æ–ª–∏ –∏ —É—Ä–æ–≤–Ω–∏ –¥–æ–≤–µ—Ä–∏—è (–Ω–∞ —Å—Ç–∞—Ä—Ç–µ —É–ø—Ä–æ—â—ë–Ω–Ω–æ)

### MVP-1
- –¢–æ–ª—å–∫–æ Self-report (—Å–∞–º–æ–æ—Ç—á—ë—Ç). –ë–µ–∑ —Å–ø–æ—Ä–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.

### MVP-2
- Buddy verification: –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–µ—Å—Å–∏—é –¥—Ä—É–≥–æ–≥–æ –≤–Ω—É—Ç—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ —Å–µ—Ç–∞.

---

## 3) –î–∞–Ω–Ω—ã–µ –∏ —Å—É—â–Ω–æ—Å—Ç–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ)

### Entities
- User
- Discipline
- RoomTemplate
- ScheduledRoom
- Session
- FriendEdge (–¥—Ä—É–∑—å—è)
- Invite (–∏–Ω–≤–∞–π—Ç—ã)
- UserSchedule (–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —à–∞–±–ª–æ–Ω—ã –∫–æ–º–Ω–∞—Ç)
- (MVP-2) Verification

### –ü–æ–ª—è (–º–∏–Ω–∏–º—É–º)
**User**: id, handle, avatarSeed, timezone, xpTotal, level, reputationScore, age, gender, createdAt  
**Discipline**: id, name, category, unitType(reps|minutes|sessions), defaultSetDurationSec, scoringProfileId  
**RoomTemplate**: id, disciplineId, title, leagueRulesetId(optional), verificationMode(self|buddy|host), raidGoal(optional), isFeatured  
**ScheduledRoom**: id, roomTemplateId, startAt, endAt, status(upcoming|live|finished), minParticipantsToStart, hostUserId(optional)  
**Session**: id, scheduledRoomId, userId, joinedAt, leftAt, resultValue, xpAwarded, verificationStatus(pending|verified|rejected), verificationLevel(self|buddy|host)

**Invite**: id, code, createdByUserId, targetUserId(optional), status(pending|accepted|expired), createdAt, acceptedAt  
**FriendEdge**: id, userIdA, userIdB, status(pending|accepted|blocked), createdAt  
**UserSchedule**: id, userId, roomTemplateId, cadence(daily|weekly|custom), timesOfDay(array), daysOfWeek(array), isEnabled, createdAt

> Note: UserSchedule –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å ¬´My Stream¬ª + –±—É–¥—É—â–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å.

---

## 4) –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç

### –ë–∞–∑–∞
- –Ø–∫–æ—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã: –∫–∞–∂–¥—ã–µ 60 –º–∏–Ω—É—Ç (–º–∏–Ω–∏–º—É–º 1‚Äì2 –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã), –ø–ª—é—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–π–º-—Ç–∞–π–º —Å–ª–æ—Ç–æ–≤.
- –ö–æ–º–Ω–∞—Ç–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ —Å—Ç–∞—Ç—É—Å LIVE —Ä–æ–≤–Ω–æ –≤ startAt, –Ω–æ UI –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ¬´–æ–∂–∏–¥–∞–Ω–∏–µ¬ª –µ—Å–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –º–µ–Ω—å—à–µ minParticipantsToStart.

### –°—Ç–∞—Ç—É—Å—ã
- Upcoming: –¥–æ startAt
- Live: startAt ‚â§ now < endAt
- Finished: now ‚â• endAt

---

## 5) –°—á—ë—Ç –∏ XP (MVP-1)

### –°—á—ë—Ç –∫–æ–º–Ω–∞—Ç—ã
- Room total = —Å—É–º–º–∞ resultValue –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–ø–æ —Å–æ–±—ã—Ç–∏—è–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –≤ live).
- Raid goal (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî —Ü–µ–ª—å total, –Ω–∞–ø—Ä–∏–º–µ—Ä 1000 reps.

### XP —Ñ–æ—Ä–º—É–ª–∞ (–ø—Ä–æ—Å—Ç–∞—è)
- AttendanceXP = 10, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –≤ –∫–æ–º–Ω–∞—Ç–µ ‚â• 60% –≤—Ä–µ–º–µ–Ω–∏
- VolumeXP = floor(k * sqrt(resultValue)) (k –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, default k=3)
- XP = AttendanceXP + VolumeXP
- Daily cap (–ø–æ–∫–∞ –º–æ–∂–Ω–æ –±–µ–∑ –∫–∞–ø–∞ –≤ MVP-1 –∏–ª–∏ –º—è–≥–∫–∏–π cap –ø–æ–∑–∂–µ)

### Streak
- Daily streak —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤ –¥–µ–Ω—å –µ—Å—Ç—å ‚â•1 –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è.

---

## 6) –†–µ–∞–ª—Ç–∞–π–º-–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ (–≥–ª–∞–≤–Ω–∞—è —á–∞—Å—Ç—å)

### UI-—ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–º–Ω–∞—Ç—ã
- –ë–æ–ª—å—à–æ–π —Ç–∞–π–º–µ—Ä (mm:ss)
- Grid ¬´–∞–≤–∞—Ç–∞—Ä–æ–∫¬ª —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (8‚Äì30)
- –ù–∞–¥ –∞–≤–∞—Ç–∞—Ä–æ–º: –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ —á–∏—Å–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä +10) –ø—Ä–∏ –∫–ª–∏–∫–µ
- –°–ø—Ä–∞–≤–∞/—Å–Ω–∏–∑—É: –æ–±—â–∏–π —Å—á—ë—Ç –∫–æ–º–Ω–∞—Ç—ã + –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä 1000 reps)
- –ö–Ω–æ–ø–∫–∏: +1 +5 +10 –∏ ¬´–≤–≤–µ—Å—Ç–∏ —á–∏—Å–ª–æ¬ª
- –ë–ª–æ–∫ ¬´Schedule for this room¬ª: Today slots + Weekly pattern

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (—á—Ç–æ–±—ã Codex –¥–µ–ª–∞–ª –º–æ–¥—É–ª—å–Ω–æ)
- `RoomArena` (layout)
- `RoomHeader` (title + league + timer)
- `RoomScheduleStrip` (today slots + week pattern)
- `RaidCounterPanel` (total + goal + progress)
- `AvatarGrid`
- `AvatarChip` (avatar + small count + floating deltas)
- `FloatingDelta` (–∞–Ω–∏–º–∞—Ü–∏—è +N)
- `IncrementControls` (+1/+5/+10 + manual)
- `PostSetPanel` (submit result + next room CTA)

### –°–æ–±—ã—Ç–∏—è —Ä–µ–∞–ª—Ç–∞–π–º–∞
- `presence_sync` (–∫—Ç–æ –≤ –∫–æ–º–Ω–∞—Ç–µ —Å–µ–π—á–∞—Å)
- `user_join`
- `user_leave`
- `increment` (userId, delta, at)
- `room_state_snapshot` (–¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)

### –ü—Ä–∞–≤–∏–ª–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞
- –ù–∞–∂–∞—Ç–∏–µ +10 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ increment(delta=10)
- –ö–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç optimistic update, —Å–µ—Ä–≤–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç –≤—Å–µ–º.

### –ê–Ω–∏–º–∞—Ü–∏–∏ (–º–∏–Ω–∏–º–∞–ª–∏–∑–º)
- `FloatingDelta` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞–¥ –∞–≤–∞—Ç–∞—Ä–æ–º –≤ —Ç–æ—á–∫–µ –∫–ª–∏–∫–∞, –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö –Ω–∞ 24‚Äì36px –∏ –∏—Å—á–µ–∑–∞–µ—Ç –∑–∞ 650‚Äì900–º—Å.
- –î–ª—è raid total: –∫–æ—Ä–æ—Ç–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–∞ (count-up) 150‚Äì250–º—Å.

---

## 7) –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –≤–∏–∑—É–∞–ª ¬´–∫–æ–º–Ω–∞—Ç—ã¬ª (–±–µ–∑ VR)

### –ö–æ–Ω—Ü–µ–ø—Ç: ¬´Arena Card¬ª
- –§–æ–Ω: –º—è–≥–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç / –ø–ª–æ—Å–∫–∏–π —Ü–≤–µ—Ç (–≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ)
- –¶–µ–Ω—Ç—Ä: Avatar Grid (–∫—Ä—É–≥–∏)
- –í–µ—Ä—Ö: Timer
- –ù–∏–∑: Controls (+1/+5/+10)
- –ü—Ä–∞–≤–æ: Raid Counter + stats

### –ê–≤–∞—Ç–∞—Ä—ã
- –£ –∫–∞–∂–¥–æ–≥–æ user: avatarSeed (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ü–≤–µ—Ç/–ø–∞—Ç—Ç–µ—Ä–Ω –ª–æ–∫–∞–ª—å–Ω–æ)
- –î–ª—è MVP –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ.

### –ü–æ–ø–∞–ø—ã –Ω–∞–¥ –∞–≤–∞—Ç–∞—Ä–æ–º
- –ü—Ä–∏ increment –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ: –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö –∏ –∏—Å—á–µ–∑–∞–µ—Ç –∑–∞ 600‚Äì900–º—Å.

---

## 8) –≠–∫—Ä–∞–Ω—ã (MVP-1)

### 8.0 Wireframes (–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å—Ö–µ–º—ã)

#### Lobby (–ª–µ–Ω—Ç–∞ –∫–æ–º–Ω–∞—Ç)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Ritual Rooms        üî• Streak 4  LV 3  ‚îÇ
‚îÇ My Schedule | Featured | All           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ NEXT UP (your stream)                  ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ Push-ups ü•à    ‚îÇ  ‚îÇ Breath üå¨Ô∏è     ‚îÇ  ‚îÇ
‚îÇ ‚îÇ starts 03:12   ‚îÇ  ‚îÇ starts 18:40  ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 12 inside      ‚îÇ  ‚îÇ 4 inside      ‚îÇ  ‚îÇ
‚îÇ ‚îÇ [Join]         ‚îÇ  ‚îÇ [Join]        ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ FEATURED                              ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ ‚îÇ Posture üßç     ‚îÇ  ‚îÇ Meditation üßò  ‚îÇ  ‚îÇ
‚îÇ ‚îÇ live now       ‚îÇ  ‚îÇ starts 55:00  ‚îÇ  ‚îÇ
‚îÇ ‚îÇ 7 inside       ‚îÇ  ‚îÇ 2 inside      ‚îÇ  ‚îÇ
‚îÇ ‚îÇ [Join]         ‚îÇ  ‚îÇ [Join]        ‚îÇ  ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Room Live (Arena Card)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Push-ups ü•à  LIVE       05:12            ‚îÇ
‚îÇ Today: 10:00 11:00 12:00 13:00 14:00     ‚îÇ
‚îÇ Week:  Mon Tue Wed Thu Fri Sat Sun       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ RAID GOAL: 1000 reps   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë 820    ‚îÇ
‚îÇ Room Total: 820   Your: 60   Rank: R2    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Avatar Grid (presence)                  ‚îÇ
‚îÇ  ‚óãA  ‚óãB  ‚óãC  ‚óãD                           ‚îÇ
‚îÇ  ‚óãE  ‚óãF  ‚óãG  ‚óãH                           ‚îÇ
‚îÇ  (under each: small count)               ‚îÇ
‚îÇ                                          ‚îÇ
‚îÇ  popups: +10 +20 appear above avatar     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [+1]  [+5]  [+10]   [Enter]             ‚îÇ
‚îÇ  Quick: [x2] [x5]   (optional later)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  After set: [Submit Result] [Confirm Buddy]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Profile / Dashboard (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Hi, @nick     LV 3   XP 1240  üõ°Ô∏è 42     ‚îÇ
‚îÇ Streak üî• 4   League: Push-ups ü•à        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Achievements (tiles)                     ‚îÇ
‚îÇ [3-day streak] [100 reps] [10 rooms]     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Your Schedule (today)                    ‚îÇ
‚îÇ 10:00 Push-ups  [Join] [Unpin]           ‚îÇ
‚îÇ 12:00 Breath    [Join] [Unpin]           ‚îÇ
‚îÇ 20:00 Posture   [Join] [Unpin]           ‚îÇ
‚îÇ + Add room template                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Friends (MVP-1 stub)                     ‚îÇ
‚îÇ [Add friend]  [Invites]                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### 8.1 Onboarding (60 —Å–µ–∫—É–Ω–¥)
- –í–≤–æ–¥ –Ω–∏–∫–∞ (handle) ‚úÖ
- –í–æ–∑—Ä–∞—Å—Ç (age) ‚úÖ
- –ü–æ–ª (gender: male/female/other/prefer_not) ‚úÖ
- –¢–∞–π–º–∑–æ–Ω–∞ (auto) ‚úÖ
- –í—ã–±–æ—Ä 1‚Äì2 –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ (discipline) (–æ–ø—Ü.)
- –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç ‚Üí —Å—Ä–∞–∑—É –Ω–∞ Dashboard

> –í–∞–∂–Ω–æ: –≤–æ–∑—Ä–∞—Å—Ç/–ø–æ–ª —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ –¥–ª—è –º–∞—Ç—á–∏–Ω–≥/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### 8.2 Dashboard (–ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞, –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- –°–≤–æ–¥–∫–∞: XP/Level, Streak, Reputation
- Achievements (–¥–æ—Å–∫–∞)
- Your Schedule (–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–æ–º–Ω–∞—Ç—ã) + –∫–Ω–æ–ø–∫–∞ ¬´Add¬ª
- –ë—ã—Å—Ç—Ä—ã–π –±–ª–æ–∫: –±–ª–∏–∂–∞–π—à–∞—è –∫–æ–º–Ω–∞—Ç–∞ (Join)
- Friends (–ø–æ–∫–∞ –º–∏–Ω–∏–º—É–º)

### 8.3 Lobby
- Tabs: My Schedule | Featured | All
- Cards: –Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞, —Å—Ç–∞—Ç—É—Å, —Ç–∞–π–º–µ—Ä, –ª—é–¥–µ–π –≤–Ω—É—Ç—Ä–∏
- CTA: Join

### 8.4 Room Live
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Arena (—Å–º. Wireframe)
- –ë–ª–æ–∫ ¬´Schedule for this room¬ª:
  - Today slots (–≤—Ä–µ–º—è) + Join
  - Weekly pattern (–ø–æ–∫–∞ –∫–∞–∫ –∫–Ω–æ–ø–∫–∏/—Ç–µ–∫—Å—Ç)

### 8.5 Profile
- XP total, level
- daily streak
- reputation score
- last sessions

### 8.6 Leaderboards
- Today / Week
- By discipline / Overall

---

## 8.7 Friends (MVP-1 –º–∏–Ω–∏–º–∞–ª—å–Ω–æ + –±–∞–∑–∞ –ø–æ–¥ —Ä–æ—Å—Ç)

### –¶–µ–ª–∏ Friends
- –ë—ã—Å—Ç—Ä–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞ –ø–æ —Å—Å—ã–ª–∫–µ
- –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (buddy-verify –≤ MVP-2)

### MVP-1 UI
- –ö–Ω–æ–ø–∫–∞ ¬´Invite link¬ª –≥–µ–Ω–µ—Ä–∏—Ç —Å—Å—ã–ª–∫—É –≤–∏–¥–∞: /invite/{code}
- –≠–∫—Ä–∞–Ω ¬´Invites¬ª: –≤—Ö–æ–¥—è—â–∏–µ/–∏—Å—Ö–æ–¥—è—â–∏–µ
- –≠–∫—Ä–∞–Ω ¬´Friends¬ª: —Å–ø–∏—Å–æ–∫, —Å—Ç–∞—Ç—É—Å online (presence)

---

## 9) –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è Codex)
 (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ –¥–ª—è Codex)

### Web
- Next.js (App Router)
- TypeScript
- Tailwind

### Backend
**–í–∞—Ä–∏–∞–Ω—Ç A (–±—ã—Å—Ç—Ä–æ): Supabase**
- Auth
- Postgres
- Realtime (broadcast + presence)

**–í–∞—Ä–∏–∞–Ω—Ç B (–∫–æ–Ω—Ç—Ä–æ–ª—å): Node + WebSocket**
- Express/Fastify
- ws
- Postgres

> –î–ª—è MVP-1: –ª—É—á—à–µ Supabase —Ä–∞–¥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏.

---

## 10) PWA
- manifest.json
- service worker
- install prompt
- (–ø–æ–∑–∂–µ) web push: iOS —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –Ω–∞ Home Screen.

---

## 11) –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–∑–∞–¥–∞—á–∏ –¥–ª—è Codex)

### Sprint 1: Skeleton + Auth
- Next.js –ø—Ä–æ–µ–∫—Ç
- —Å—Ç—Ä–∞–Ω–∏—Ü—ã: / (onboarding), /dashboard, /lobby, /room/[id], /profile, /leaderboards, /friends, /invites
- Supabase Auth (magic link –∏–ª–∏ otp)
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: handle, age, gender, timezone, avatarSeed

### Sprint 2: Data + Schedule
- SQL migrations –¥–ª—è —Ç–∞–±–ª–∏—Ü (—Å–º. Entities)
- Seed –¥–∏—Å—Ü–∏–ø–ª–∏–Ω + 3‚Äì5 —à–∞–±–ª–æ–Ω–æ–≤ –∫–æ–º–Ω–∞—Ç
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å—É—Ç–∫–∏ (server action/cron) ‚Üí scheduled_rooms
- –õ–æ–±–±–∏: –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–Ω–∞—Ç (next 24h) + —Å—Ç–∞—Ç—É—Å/—Ç–∞–π–º–µ—Ä
- Dashboard: My Schedule (UserSchedule) + –±–ª–∏–∂–∞–π—à–∏–µ –∫–æ–º–Ω–∞—Ç—ã

### Sprint 3: Realtime Room (Arena UI)
- Presence —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- Broadcast increment events
- Snapshot —Å–æ—Å—Ç–æ—è–Ω–∏—è (–¥–ª—è –Ω–æ–≤—ã—Ö)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: RoomArena, AvatarGrid, FloatingDelta, RaidCounterPanel, IncrementControls
- –ë–ª–æ–∫ ScheduleStrip (today slots + week pattern)

### Sprint 4: Scoring + History
- –ù–∞ endAt: —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏ (resultValue)
- XP: attendance + sqrt(volume)
- Update user xpTotal, level
- Daily streak
- Sessions history

### Sprint 5 (MVP-1 polish)
- Leaderboards self (today/week)
- Achievements (10‚Äì15 –ø—Ä–æ—Å—Ç—ã—Ö)
- Invite links + Friends –±–∞–∑–∞ (–±–µ–∑ buddy-verify –ø–æ–∫–∞)

### Sprint 6 (MVP-2)
- Buddy-verify —Ç–∞–±–ª–∏—Ü–∞ Verification
- Verified leaderboard
- –ú—è–≥–∫–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è

---

## 12) –ß–µ–∫-–ª–∏—Å—Ç UX (–≤–∞–∂–Ω–æ)
- –í –∫–æ–º–Ω–∞—Ç–µ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ: —Ç–∞–π–º–µ—Ä, –º–æ–π —Å—á—ë—Ç, –æ–±—â–∏–π —Å—á—ë—Ç.
- –ö–Ω–æ–ø–∫–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ –∫—Ä—É–ø–Ω—ã–µ (–±–æ–ª—å—à–æ–π –ø–∞–ª–µ—Ü).
- –ü–æ—Å–ª–µ –∫–æ–º–Ω–∞—Ç—ã ‚Äî –ø–æ–Ω—è—Ç–Ω—ã–π —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: ¬´–¢—ã —Å–¥–µ–ª–∞–ª X, –ø–æ–ª—É—á–∏–ª Y XP, —Å—Ç—Ä–∏–∫ Z¬ª.
- –ù–∞ Dashboard: ¬´—Å–ª–µ–¥—É—é—â–∞—è –∫–æ–º–Ω–∞—Ç–∞¬ª + 1 –∫–Ω–æ–ø–∫–∞ Join.

---

## 13) –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ–º –≤ MVP-1
- –í–∏–¥–µ–æ/–≥–æ–ª–æ—Å (WebRTC)
- –°–ª–æ–∂–Ω—ã–π –∞–Ω—Ç–∏—Ñ—Ä–æ–¥
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ —Å–µ–∑–æ–Ω—ã/–∫–ª–∞–Ω—ã
- Wearables

---

## 14) –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è Codex (—à–∞–±–ª–æ–Ω)

**PROMPT 1 ‚Äî Project bootstrap**
- Create Next.js (App Router) TS project with Tailwind.
- Add routes: / (onboarding), /dashboard, /lobby, /room/[id], /profile, /leaderboards, /friends, /invites.
- Implement layout + navigation.

**PROMPT 2 ‚Äî Supabase schema**
- Provide SQL migrations for tables: users, disciplines, room_templates, scheduled_rooms, sessions, invites, friend_edges, user_schedules.
- Include indexes for leaderboards and queries.

**PROMPT 3 ‚Äî Onboarding + user profile**
- Implement onboarding form: handle, age, gender.
- Persist to users table.
- Redirect to /dashboard.

**PROMPT 4 ‚Äî Lobby + schedule**
- Fetch scheduled_rooms for next 24h.
- Render cards with countdown and participants count.

**PROMPT 5 ‚Äî Realtime room arena**
- Implement presence + broadcast increment events.
- Maintain local state: participants, totals, per-user count.
- Add floating delta animation over avatar.
- Render schedule strip (today slots).

**PROMPT 6 ‚Äî Scoring + streak**
- On room end, compute attendance, volume XP and update user xpTotal, level.
- Update daily streak.
- Store session history.

**PROMPT 7 ‚Äî Invites + friends**
- Generate invite code links.
- Accept invite and create friend edge.
- Show friends list with online presence indicator.

---

# Appendix: –§–æ—Ä–º—É–ª—ã —É—Ä–æ–≤–Ω–µ–π (–ø—Ä–æ—Å—Ç—ã–µ)
- level = floor(sqrt(xpTotal / 100)) + 1

---

# Appendix: –ú–∏–Ω–∏-—Å–ø–µ–∫–∞ ¬´Avatar Grid¬ª
- Grid responsive: 4‚Äì6 columns on mobile
- Each avatar: circle 44‚Äì56px
- Display small label: current reps under avatar
- On popup: absolute positioned text rising animation

---

# 15) SQL (Supabase/Postgres) ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ (–≥–æ—Ç–æ–≤—ã–π –±–ª–æ–∫ –¥–ª—è Codex)

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: Supabase —É–∂–µ –∏–º–µ–µ—Ç auth.users. –ù–∏–∂–µ ‚Äî app-—Ç–∞–±–ª–∏—Ü—ã.  
> –í users —Ö—Ä–∞–Ω–∏–º app-–ø—Ä–æ—Ñ–∏–ª—å –∏ —Å–≤—è–∑—ã–≤–∞–µ–º —Å auth.users —á–µ—Ä–µ–∑ user_id UUID.

```sql
-- 001_init.sql

create table if not exists public.profiles (
  user_id uuid primary key references auth.users(id) on delete cascade,
  handle text unique not null check (char_length(handle) between 3 and 20),
  avatar_seed text not null,
  timezone text not null,
  age smallint not null check (age between 13 and 120),
  gender text not null check (gender in ('male','female','other','prefer_not')),
  xp_total integer not null default 0,
  level integer not null default 1,
  reputation_score integer not null default 0,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

create index if not exists profiles_xp_idx on public.profiles (xp_total desc);

create table if not exists public.disciplines (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  category text not null check (category in ('strength','mobility','breath','mindfulness','recovery')),
  unit_type text not null check (unit_type in ('reps','minutes','sessions')),
  default_set_duration_sec integer not null,
  scoring_k integer not null default 3,
  created_at timestamptz not null default now()
);

create table if not exists public.room_templates (
  id uuid primary key default gen_random_uuid(),
  discipline_id uuid not null references public.disciplines(id) on delete cascade,
  title text not null,
  verification_mode text not null default 'self' check (verification_mode in ('self','buddy','host')),
  raid_goal integer,
  is_featured boolean not null default false,
  min_participants_to_start integer not null default 1,
  created_at timestamptz not null default now()
);

create index if not exists room_templates_discipline_idx on public.room_templates(discipline_id);

create table if not exists public.scheduled_rooms (
  id uuid primary key default gen_random_uuid(),
  room_template_id uuid not null references public.room_templates(id) on delete cascade,
  start_at timestamptz not null,
  end_at timestamptz not null,
  status text not null default 'upcoming' check (status in ('upcoming','live','finished','cancelled')),
  host_user_id uuid references auth.users(id) on delete set null,
  created_at timestamptz not null default now()
);

create index if not exists scheduled_rooms_start_idx on public.scheduled_rooms(start_at);
create index if not exists scheduled_rooms_template_idx on public.scheduled_rooms(room_template_id);

create table if not exists public.sessions (
  id uuid primary key default gen_random_uuid(),
  scheduled_room_id uuid not null references public.scheduled_rooms(id) on delete cascade,
  user_id uuid not null references auth.users(id) on delete cascade,
  joined_at timestamptz not null default now(),
  left_at timestamptz,
  result_value integer not null default 0,
  xp_awarded integer not null default 0,
  verification_status text not null default 'pending' check (verification_status in ('pending','verified','rejected')),
  verification_level text not null default 'self' check (verification_level in ('self','buddy','host')),
  created_at timestamptz not null default now()
);

create index if not exists sessions_user_idx on public.sessions(user_id, created_at desc);
create index if not exists sessions_room_idx on public.sessions(scheduled_room_id);

create table if not exists public.user_schedules (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null references auth.users(id) on delete cascade,
  room_template_id uuid not null references public.room_templates(id) on delete cascade,
  cadence text not null default 'daily' check (cadence in ('daily','weekly','custom')),
  times_of_day text[] not null default array[]::text[],
  days_of_week int[] not null default array[]::int[],
  is_enabled boolean not null default true,
  created_at timestamptz not null default now()
);

create index if not exists user_schedules_user_idx on public.user_schedules(user_id);

create table if not exists public.invites (
  id uuid primary key default gen_random_uuid(),
  code text unique not null,
  created_by_user_id uuid not null references auth.users(id) on delete cascade,
  target_user_id uuid references auth.users(id) on delete set null,
  status text not null default 'pending' check (status in ('pending','accepted','expired')),
  created_at timestamptz not null default now(),
  accepted_at timestamptz
);

create index if not exists invites_creator_idx on public.invites(created_by_user_id, created_at desc);

create table if not exists public.friend_edges (
  id uuid primary key default gen_random_uuid(),
  user_id_a uuid not null references auth.users(id) on delete cascade,
  user_id_b uuid not null references auth.users(id) on delete cascade,
  status text not null default 'pending' check (status in ('pending','accepted','blocked')),
  created_at timestamptz not null default now(),
  unique(user_id_a, user_id_b)
);

create index if not exists friend_edges_a_idx on public.friend_edges(user_id_a);
create index if not exists friend_edges_b_idx on public.friend_edges(user_id_b);

create table if not exists public.daily_streaks (
  user_id uuid primary key references auth.users(id) on delete cascade,
  current integer not null default 0,
  best integer not null default 0,
  last_completed_date date
);

-- MVP-2: verification
create table if not exists public.verifications (
  id uuid primary key default gen_random_uuid(),
  session_id uuid not null references public.sessions(id) on delete cascade,
  verifier_user_id uuid not null references auth.users(id) on delete cascade,
  type text not null check (type in ('buddy','host')),
  status text not null default 'confirmed' check (status in ('confirmed','disputed')),
  created_at timestamptz not null default now(),
  unique(session_id, verifier_user_id)
);

-- updated_at trigger
create or replace function public.set_updated_at() returns trigger as $$
begin
  new.updated_at = now();
  return new;
end;
$$ language plpgsql;

drop trigger if exists profiles_updated_at on public.profiles;
create trigger profiles_updated_at before update on public.profiles
for each row execute procedure public.set_updated_at();
```

---

# 16) RLS (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –º–∏–Ω–∏–º—É–º)

> –î–ª—è MVP –ª—É—á—à–µ –≤–∫–ª—é—á–∏—Ç—å RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∏ –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ.

## 16.1 profiles
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å —Å–≤–æ–π profile
- –ø—É–±–ª–∏—á–Ω–æ –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ handle + avatar_seed + level (–±–µ–∑ age/gender)

## 16.2 sessions
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å –∏ —á–∏—Ç–∞—Ç—å —Å–≤–æ–∏ sessions
- –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã —á–∏—Ç–∞—é—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã (—á–µ—Ä–µ–∑ view) –∏–ª–∏ —á–µ—Ä–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π select

> Codex: —Å–¥–µ–ª–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `rls.sql` —Å–æ –≤—Å–µ–º–∏ policy.

---

# 17) Views –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ (—É–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã)

```sql
-- 002_views.sql

create or replace view public.leaderboard_today as
select
  s.user_id,
  p.handle,
  p.avatar_seed,
  sum(s.result_value) as total_value,
  sum(s.xp_awarded) as total_xp,
  date_trunc('day', now()) as day
from public.sessions s
join public.profiles p on p.user_id = s.user_id
where s.created_at >= date_trunc('day', now())
group by s.user_id, p.handle, p.avatar_seed;

create or replace view public.leaderboard_week as
select
  s.user_id,
  p.handle,
  p.avatar_seed,
  sum(s.result_value) as total_value,
  sum(s.xp_awarded) as total_xp
from public.sessions s
join public.profiles p on p.user_id = s.user_id
where s.created_at >= date_trunc('week', now())
group by s.user_id, p.handle, p.avatar_seed;
```

---

# 18) API / Queries –ø–æ —ç–∫—Ä–∞–Ω–∞–º (—á—Ç–æ–±—ã Codex –Ω–µ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞–ª)

## 18.1 Onboarding
- create profile row for auth user
- fields: handle, age, gender, timezone, avatar_seed

## 18.2 Dashboard
- `GET my profile` (xp, level, streak, reputation)
- `GET my schedule templates` (user_schedules join room_templates join disciplines)
- `GET next upcoming rooms for my schedule` (next 6‚Äì12 —á–∞—Å–æ–≤)
- `GET achievements` (MVP-2)

## 18.3 Lobby
- `GET scheduled_rooms next 24h` with template + discipline + participants_count (presence)
- filter tabs:
  - Featured: templates is_featured=true
  - My Schedule: only templates in user_schedules
  - All: all

## 18.4 Room Live
- `GET scheduled_room by id` + template + discipline
- `GET today slots for this template` (room schedule strip) 
- Realtime:
  - presence list
  - increment events
  - room snapshot
- `POST session increment` (event)
- `POST finalize session` on end

## 18.5 Friends / Invites
- `POST create invite` ‚Üí code
- `POST accept invite` ‚Üí create friend_edge accepted
- `GET my friends` (handle, avatar, online)

---

# 19) –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—Ä–∞–∑ –≤ —á–∞—Å, —Å—Ç–∞–Ω–¥–∞—Ä—Ç)

## 19.1 –ü—Ä–∞–≤–∏–ª–æ
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ `room_template` —Å–æ–∑–¥–∞—ë–º —Å–ª–æ—Ç—ã –Ω–∞ —Å—É—Ç–∫–∏: 24 —Å–ª–æ—Ç–∞.
- start_at = –∫–∞–∂–¥—ã–π —á–∞—Å (00:00, 01:00, ‚Ä¶) –≤ —Ç–∞–π–º–∑–æ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? 
  - MVP: —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ UTC, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ.
- end_at = start_at + default_set_duration_sec + buffer (–Ω–∞–ø—Ä–∏–º–µ—Ä 10 –º–∏–Ω total)
  - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: set duration 6 –º–∏–Ω + post 2 –º–∏–Ω + buffer 2 –º–∏–Ω = 10 –º–∏–Ω.

## 19.2 –ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ç—å
- –û–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å –≥–µ–Ω–µ—Ä–∏—Ç—å `scheduled_rooms` –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ 48 —á–∞—Å–æ–≤, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –¥—ã—Ä.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è: –µ—Å–ª–∏ —Å–ª–æ—Ç —É–∂–µ –µ—Å—Ç—å ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º.

## 19.3 –ü—Å–µ–≤–¥–æ–∫–æ–¥
```
for template in room_templates:
  for hour in next_48_hours_hourslots_utc:
    slotStart = floor_to_hour(hour)
    slotEnd = slotStart + template.defaultDuration (or discipline default)
    upsert scheduled_rooms(template, slotStart)
```

## 19.4 –ì–¥–µ –∑–∞–ø—É—Å–∫–∞—Ç—å
- MVP: server action –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ –≤ /lobby (lazy –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- –õ—É—á—à–µ: cron (Supabase Scheduled Functions / external cron) —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏

---

# 20) Realtime state model (—á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞–ª–æ—Å—å)

## 20.1 Room state
- `participants`: —Å–ø–∏—Å–æ–∫ user_id + handle + avatar_seed + current_value
- `room_total`
- `last_events` (–∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä 50 —Å–æ–±—ã—Ç–∏–π) ‚Äî optional

## 20.2 Snapshot
- –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç snapshot (HTTP) –∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç broadcast snapshot
- –∑–∞—Ç–µ–º —Å–ª—É—à–∞–µ—Ç increment events

## 20.3 Presence
- –≤ presence —Ö—Ä–∞–Ω–∏—Ç—å `user_id`, `handle`, `avatar_seed`
- online friends: —á–µ—Ä–µ–∑ presence channel friends (MVP –ø–æ–∑–∂–µ)

---

# 21) UI: –¥–µ—Ç–∞–ª–∏ –∞–Ω–∏–º–∞—Ü–∏–π –∏ –≤–∏–∑—É–∞–ª–∞ (–º–∏–Ω–∏–º–∞–ª–∏–∑–º)

## 21.1 AvatarChip
- –∫—Ä—É–≥ 48px, –≤–Ω—É—Ç—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª—ã/–ø–∞—Ç—Ç–µ—Ä–Ω
- –ø–æ–¥ –Ω–∏–º –º–∞–ª–µ–Ω—å–∫–æ–µ —á–∏—Å–ª–æ (current_value)
- –ø—Ä–∏ increment ‚Äî –ª—ë–≥–∫–∏–π scale pulse 1.0‚Üí1.06‚Üí1.0

## 21.2 FloatingDelta
- —Ç–µ–∫—Å—Ç +N (–Ω–∞–ø—Ä–∏–º–µ—Ä +20)
- –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞–¥ –∞–≤–∞—Ç–∞—Ä–æ–º, —Å opacity 1‚Üí0 –∏ translateY 0‚Üí-28
- duration 750ms, easing out

## 21.3 RaidCounterPanel
- total count-up (–∞–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–ª–∞ 200ms)
- progress bar –ø–ª–∞–≤–Ω–æ

---

# 22) Codex: –∫–∞–∫ –Ω–µ —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ —Ç–æ–∫–µ–Ω—ã (–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)

## 22.1 –†–µ–∞–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç Codex –º–æ–∂–µ—Ç —Å–æ–±—Ä–∞—Ç—å, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
  - –¥–∞–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ (—Ñ–∞–π–ª/–º–æ–¥—É–ª—å –∑–∞ —Ä–∞–∑)
  - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ API –∑–∞—Ä–∞–Ω–µ–µ (–≤ —ç—Ç–æ–º –¢–ó)

## 22.2 –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ—Å–∏—Ç—å ¬´—Å–¥–µ–ª–∞–π –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç —Ü–µ–ª–∏–∫–æ–º –æ–¥–Ω–∏–º –æ—Ç–≤–µ—Ç–æ–º¬ª.
- –î–µ–ª–∏—Ç—å –ø–æ Sprint-–∞–º: 1) bootstrap, 2) schema, 3) lobby, 4) realtime room, 5) scoring.
- –í –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –≤—Å—Ç–∞–≤–ª—è—Ç—å:
  - –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å/–º–µ–Ω—è—Ç—å
  - —Ç–æ—á–Ω—ã–π expected output
  - –∑–∞–ø—Ä–µ—Ç –Ω–∞ –ª–∏—à–Ω—é—é –±–æ–ª—Ç–æ–≤–Ω—é

## 22.3 –ï—Å–ª–∏ —É–ø–∏—Ä–∞–µ–º—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –†–∞–±–æ—Ç–∞—Ç—å ¬´–ø–æ —Ñ–∞–π–ª–∞–º¬ª: –ø—Ä–æ—Å–∏—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª.
- –ü—Ä–æ—Å–∏—Ç—å –≤—ã–≤–æ–¥–∏—Ç—å diff/patch.
- –î–µ—Ä–∂–∞—Ç—å —ç—Ç–æ—Ç –¢–ó –∫–∞–∫ ¬´source of truth¬ª, –∞ Codex ‚Äî –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å.

## 22.4 –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç ¬´–≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É: endpoints, schema, wireframes.
- –ü–æ–ø—Ä–æ—Å–∏—Ç—å –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (manual QA checklist) –≤–º–µ—Å—Ç–æ –Ω–æ–≤—ã—Ö —Ñ–∏—á.

---

# 23) QA —á–µ–∫-–ª–∏—Å—Ç (—Ä—É—á–Ω–æ–π)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: handle/age/gender —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è.
- Dashboard: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç XP/level/streak, –±–ª–∏–∂–∞–π—à—É—é –∫–æ–º–Ω–∞—Ç—É.
- Lobby: —Ç–∞–π–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, —Å—Ç–∞—Ç—É—Å—ã –∫–æ–º–Ω–∞—Ç –º–µ–Ω—è—é—Ç—Å—è.
- Room: –¥–≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–∏–¥—è—Ç –æ–±—â–∏–π —Å—á—ë—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, popups —Ä–∞–±–æ—Ç–∞—é—Ç.
- End: XP –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è, streak —Ä–∞—Å—Ç—ë—Ç 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å.
- Invites: —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è, –¥—Ä—É–≥ –ø–æ—è–≤–ª—è–µ—Ç—Å—è.

---

# 24) Deployment (—á—Ç–æ–±—ã —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –∂–∏–ª–æ)
- Front: Vercel
- Supabase project: env vars
- Cron: –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ (—á–µ—Ä–µ–∑ Supabase Scheduled Functions –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π cron)

---

# 25) Roadmap (–ø–æ—Å–ª–µ MVP-1)
- Buddy-verify + Verified leaderboards
- Reputation tiers
- Seasons + clans
- Host rooms
- Voice (–Ω–µ –≤–∏–¥–µ–æ): –æ–¥–∏–Ω –≤–µ–¥—É—â–∏–π –≤–µ—â–∞–µ—Ç
- Anti-surge / cooldown

---

# 26) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–∞–ø–∫–∏/—Ñ–∞–π–ª—ã) üì¶

> –¶–µ–ª—å: Codex —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ñ–∞–π–ª–∞–º, –ª–µ–≥–∫–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, –ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ diff/PR.

**Root**
- `SPEC.md` ‚Äî —ç—Ç–æ –¢–ó (source of truth)
- `README.md` ‚Äî –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å
- `.env.example` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `sql/` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏
  - `001_init.sql`
  - `002_views.sql`
  - `rls.sql`

**Next.js (App Router)**
- `app/`
  - `layout.tsx` ‚Äî –æ–±—â–∏–π layout + nav
  - `page.tsx` ‚Äî onboarding (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω) / redirect
  - `dashboard/page.tsx`
  - `lobby/page.tsx`
  - `room/[id]/page.tsx`
  - `profile/page.tsx`
  - `leaderboards/page.tsx`
  - `friends/page.tsx`
  - `invites/page.tsx`
- `components/`
  - `arena/RoomArena.tsx`
  - `arena/RoomHeader.tsx`
  - `arena/RoomScheduleStrip.tsx`
  - `arena/RaidCounterPanel.tsx`
  - `arena/AvatarGrid.tsx`
  - `arena/AvatarChip.tsx`
  - `arena/FloatingDelta.tsx`
  - `arena/IncrementControls.tsx`
  - `arena/ProgramPanel.tsx`
  - `ui/` (–∫–Ω–æ–ø–∫–∏, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ç–∞–±—ã)
- `lib/`
  - `supabase/client.ts`
  - `supabase/server.ts`
  - `auth/guards.ts`
  - `schedule/generator.ts`
  - `realtime/roomChannel.ts`
  - `scoring/xp.ts`
  - `streaks/streaks.ts`
  - `avatars/avatarSeed.ts`
- `types/`
  - `db.ts` (—Ç–∏–ø–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü)
  - `realtime.ts` (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π)
  - `programs.ts` (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º)

---

# 27) Realtime: JSON-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π üõ∞Ô∏è

> –≠—Ç–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã: Codex –Ω–µ –¥–æ–ª–∂–µ–Ω –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã.

## 27.1 –ö–∞–Ω–∞–ª—ã
- `room:{scheduled_room_id}` ‚Äî presence + —Å–æ–±—ã—Ç–∏—è –∫–æ–º–Ω–∞—Ç—ã
- (–ø–æ–∑–∂–µ) `friends:{user_id}` ‚Äî –æ–Ω–ª–∞–π–Ω-–¥—Ä—É–∑—å—è

## 27.2 Message Envelope
```json
{
  "type": "increment",
  "roomId": "uuid",
  "ts": "2026-02-14T12:34:56.000Z",
  "payload": {}
}
```

## 27.3 presence_sync (—Å–Ω–∏–º–æ–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è)
```json
{
  "type": "presence_sync",
  "roomId": "uuid",
  "ts": "...",
  "payload": {
    "participants": [
      {"userId": "uuid", "handle": "nick", "avatarSeed": "seed", "currentValue": 40, "ready": false}
    ]
  }
}
```

## 27.4 room_state_snapshot (—Å–Ω–∏–º–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
```json
{
  "type": "room_state_snapshot",
  "roomId": "uuid",
  "ts": "...",
  "payload": {
    "run": {
      "runId": "uuid",
      "status": "waiting",
      "startAt": null,
      "endAt": null,
      "programId": "uuid"
    },
    "roomTotal": 120,
    "participants": [
      {"userId": "uuid", "handle": "nick", "avatarSeed": "seed", "currentValue": 40, "ready": false}
    ]
  }
}
```

## 27.5 increment (–∫–ª–∏–∫ +N)
```json
{
  "type": "increment",
  "roomId": "uuid",
  "ts": "...",
  "payload": {
    "runId": "uuid",
    "userId": "uuid",
    "delta": 10,
    "newUserValue": 50,
    "newRoomTotal": 130
  }
}
```

## 27.6 ready_toggle (–≥–æ—Ç–æ–≤/–Ω–µ –≥–æ—Ç–æ–≤)
```json
{
  "type": "ready_toggle",
  "roomId": "uuid",
  "ts": "...",
  "payload": {
    "runId": "uuid",
    "userId": "uuid",
    "ready": true
  }
}
```

## 27.7 run_start (—Å—Ç–∞—Ä—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã)
```json
{
  "type": "run_start",
  "roomId": "uuid",
  "ts": "...",
  "payload": {
    "runId": "uuid",
    "startAt": "2026-02-14T12:00:10.000Z",
    "endAt": "2026-02-14T12:06:10.000Z",
    "programId": "uuid"
  }
}
```

## 27.8 run_end (–∫–æ–Ω–µ—Ü)
```json
{
  "type": "run_end",
  "roomId": "uuid",
  "ts": "...",
  "payload": {
    "runId": "uuid",
    "endedAt": "..."
  }
}
```

---

# 28) –°—Ç–∞—Ä—Ç –∫–æ–º–Ω–∞—Ç—ã ¬´–≤–¥–≤–æ—ë–º/–≤—Ç—Ä–æ—ë–º –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—Ç–∏–º¬ª üü¢

## 28.1 –ü—Ä–æ–±–ª–µ–º–∞
- –ï—Å–ª–∏ –∂–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ minimum —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Äî —Ç–µ—Ä—è–µ—Ç—Å—è –∏–º–ø—É–ª—å—Å.

## 28.2 –†–µ—à–µ–Ω–∏–µ (MVP-1)
–í –∫–∞–∂–¥–æ–π –∫–æ–º–Ω–∞—Ç–µ –µ—Å—Ç—å —Ä–µ–∂–∏–º **Waiting ‚Üí Ready ‚Üí Start**.

### UI
- –ö–Ω–æ–ø–∫–∞: `I'm Ready` (toggle)
- –ö–Ω–æ–ø–∫–∞: `Start Now` (–¥–æ—Å—Ç—É–ø–Ω–∞ –µ—Å–ª–∏ —Ç—ã Ready)
- –°—Ç–∞—Ç—É—Å: —Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ Ready

### –ü—Ä–∞–≤–∏–ª–∞ —Å—Ç–∞—Ä—Ç–∞ (–ø—Ä–æ—Å—Ç—ã–µ)
- –ö–æ–º–Ω–∞—Ç—É –º–æ–∂–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å **—Å –ª—é–±—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ª—é–¥–µ–π (‚â•1)**.
- –ï—Å–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π:
  - —Å—Ç–∞—Ä—Ç –≤–æ–∑–º–æ–∂–µ–Ω –∫–æ–≥–¥–∞ **–≤—Å–µ —Ç–µ–∫—É—â–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –æ—Ç–º–µ—Ç–∏–ª–∏—Å—å Ready**
  - –ª–∏–±–æ —á–µ—Ä–µ–∑ **Manual Start** –æ–¥–Ω–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 10-—Å–µ–∫. –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–≥—É—Ç –Ω–∞–∂–∞—Ç—å Ready –∏ ¬´–ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—å—Å—è¬ª
- –ü–æ–∑–¥–Ω–∏–π –≤—Ö–æ–¥: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–π—Ç–∏ –≤ —É–∂–µ –Ω–∞—á–∞—Ç—ã–π run –∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å (—É –Ω–µ–≥–æ –±—É–¥–µ—Ç –º–µ–Ω—å—à–µ attendance).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏
- –î–æ–±–∞–≤–ª—è–µ–º —Å—É—â–Ω–æ—Å—Ç—å `run` (–º–æ–∂–µ—Ç –±—ã—Ç—å in-memory –≤ realtime –Ω–∞ MVP-1):
  - `runId`, `status(waiting|running|ended)`, `startAt`, `endAt`, `programId`
- –ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ `startAt` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –µ–¥–∏–Ω—ã–º –¥–ª—è –≤—Å–µ—Ö.

> –í–∞–∂–Ω–æ: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥—ã–π —á–∞—Å –æ—Å—Ç–∞—ë—Ç—Å—è (–¥–ª—è ¬´—Ä–∏—Ç—É–∞–ª–∞¬ª), –Ω–æ –µ—Å—Ç—å –∏ ¬´—Å—Ç–∞—Ä—Ç –ø–æ –∂–µ–ª–∞–Ω–∏—é¬ª.

---

# 29) ¬´–ü—Ä–æ–≥—Ä–∞–º–º–∞¬ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–Ω–∞—Ç—ã (–±–µ–∑ –≤–µ–¥—É—â–∏—Ö) üß†‚è±Ô∏è

> –¶–µ–ª—å: –¥–∞–∂–µ –±–µ–∑ –º–æ–¥–µ—Ä–æ–≤ –ø—Ä–æ–¥—É–∫—Ç –æ—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ guided session: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ + –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã + –æ—Ç–¥—ã—Ö.

## 29.1 –ö–æ–Ω—Ü–µ–ø—Ç: Program Engine
- –£ –∫–∞–∂–¥–æ–π –∫–æ–º–Ω–∞—Ç—ã –µ—Å—Ç—å `programId`.
- Program = —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤ (steps), –∫–æ—Ç–æ—Ä—ã–µ –∏–¥—É—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏.
- UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
  - —Ç–µ–∫—É—â—É—é –∫–æ–º–∞–Ω–¥—É (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
  - —Ç–∞–π–º–µ—Ä —à–∞–≥–∞
  - —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
  - –æ–±—â–∏–π —Ç–∞–π–º–µ—Ä run

### ProgramStep (–∫–æ–Ω—Ç—Ä–∞–∫—Ç)
- `type`: `prep | work | rest | breathe | hold | recover | guidance | finish`
- `durationSec`
- `title`
- `text` (–∫–æ—Ä–æ—Ç–∫–∞—è –∫–æ–º–∞–Ω–¥–∞)

## 29.2 Program templates (MVP-1: 3 —à—Ç—É–∫–∏)

### A) Push-ups (6 –º–∏–Ω—É—Ç, –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã)
- PREP 20s: ¬´–ü–ª–µ—á–∏ –≤–Ω–∏–∑, –∫–æ—Ä–ø—É—Å —Ä–æ–≤–Ω—ã–π, –¥—ã—Ö–∞–Ω–∏–µ —Å–ø–æ–∫–æ–π–Ω–æ¬ª
- WORK 60s: ¬´–î–µ–ª–∞–π –æ—Ç–∂–∏–º–∞–Ω–∏—è. –°—á–∏—Ç–∞–π –∏ –∂–º–∏ +10/+5/+1¬ª
- REST 20s: ¬´–û—Ç–¥—ã—Ö. –í—Å—Ç—Ä—è—Ö–Ω–∏ —Ä—É–∫–∏, –≤–¥–æ—Ö-–≤—ã–¥–æ—Ö¬ª
- WORK 60s
- REST 20s
- WORK 60s
- REST 20s
- WORK 60s
- REST 20s
- WORK 60s
- FINISH 20s: ¬´–°—Ç–æ–ø. –ó–∞–ø–∏—à–∏ –∏—Ç–æ–≥ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏ –¥—ã—Ö–∞–Ω–∏–µ¬ª

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ 5 —Ä–∞–±–æ—á–∏—Ö —Ä–∞—É–Ω–¥–æ–≤ –ø–æ 60s + –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–¥—ã—Ö–∏. –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞.

### B) Meditation (6 –º–∏–Ω—É—Ç)
- PREP 30s: ¬´–°—è–¥—å —É–¥–æ–±–Ω–æ. –°–ø–∏–Ω–∞ —Ä–æ–≤–Ω–æ. –ó–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞.¬ª
- GUIDANCE 30s: ¬´–í–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥—ã—Ö–∞–Ω–∏–µ. –í–¥–æ—Ö/–≤—ã–¥–æ—Ö.¬ª
- GUIDANCE 240s: ¬´–ï—Å–ª–∏ –º—ã—Å–ª–∏ —É–≤–æ–¥—è—Ç ‚Äî –º—è–≥–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∫ –¥—ã—Ö–∞–Ω–∏—é.¬ª
- GUIDANCE 60s: ¬´–°–∫–∞–Ω —Ç–µ–ª–∞: –ª–∏—Ü–æ, –ø–ª–µ—á–∏, –∂–∏–≤–æ—Ç ‚Äî —Ä–∞—Å—Å–ª–∞–±—å.¬ª
- FINISH 60s: ¬´–û—Ç–∫—Ä–æ–π –≥–ª–∞–∑–∞. –û—Ç–º–µ—Ç—å —Å–µ—Å—Å–∏—é.¬ª

### C) Wim Hof (—É–ø—Ä–æ—â—ë–Ω–Ω–æ, 2 —Ä–∞—É–Ω–¥–∞ ‚Äî MVP)
> –í–∞–∂–Ω–æ: –Ω–µ –¥–∞–≤–∞—Ç—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –æ–±–µ—â–∞–Ω–∏–π. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –¥–µ–ª–∞—Ç—å —Å–∏–¥—è/–ª—ë–∂–∞, –Ω–µ –≤ –≤–æ–¥–µ, –Ω–µ –∑–∞ —Ä—É–ª—ë–º.

- PREP 20s: ¬´–°—è–¥—å/–ª—è–≥. –ì–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö, –º—è–≥–∫–∏–π –≤—ã–¥–æ—Ö.¬ª
- BREATHE 90s: ¬´30‚Äì40 —Ä–∏—Ç–º–∏—á–Ω—ã—Ö –≤–¥–æ—Ö–æ–≤. –í–¥–æ—Ö –ø–æ–ª–Ω—ã–π, –≤—ã–¥–æ—Ö —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–Ω—ã–π.¬ª
- HOLD 60s: ¬´–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤—ã–¥–æ—Ö–µ. –†–∞—Å—Å–ª–∞–±—å—Å—è.¬ª
- RECOVER 15s: ¬´–ì–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ.¬ª
- BREATHE 90s
- HOLD 60s
- RECOVER 15s
- FINISH 30s: ¬´–î—ã—à–∏ —Å–ø–æ–∫–æ–π–Ω–æ. –û—Ç–º–µ—Ç—å —Å–µ—Å—Å–∏—é.¬ª

> –ü–æ–∑–∂–µ: –¥–∞—Ç—å 3-–π —Ä–∞—É–Ω–¥ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

## 29.3 UI: ProgramPanel
- —Å–≤–µ—Ä—Ö—É: —Ç–µ–∫—É—â–∏–π step title
- –∫—Ä—É–ø–Ω–æ: countdown step
- —Ç–µ–∫—Å—Ç: –∫–æ–º–∞–Ω–¥–∞
- —Å–Ω–∏–∑—É: next step preview

## 29.4 –ù–æ—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (MVP)
- –î–ª—è –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ + —á–µ–∫–±–æ–∫—Å ¬´–ø–æ–Ω–∏–º–∞—é¬ª –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ.
- –î–ª—è —Å–∏–ª–æ–≤—ã—Ö: ¬´–¥–µ–ª–∞–π –ø–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—é, –±–µ–∑ –±–æ–ª–∏¬ª.

---

# 30) –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∫–æ–º–Ω–∞—Ç—ã (–≤–Ω—É—Ç—Ä–∏ Room)

## 30.1 Today slots
- –í `RoomScheduleStrip` –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ 6‚Äì8 —Å–ª–æ—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è (–∫–∞–∂–¥—ã–π —á–∞—Å).
- –ö–ª–∏–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ ‚Üí –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π scheduled_room.

## 30.2 Weekly view
- –ü–æ–∫–∞ –∫–∞–∫ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä: 7 –¥–Ω–µ–π —Å –æ—Ç–º–µ—Ç–∫–æ–π —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∑–∞—Ö–æ–¥–∏–ª.

---

# 31) Codex Prompts (–¥–æ–±–∞–≤–∫–∞ –ø–æ–¥ –Ω–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)

**PROMPT 8 ‚Äî Project structure**
- Restructure project exactly as in section 26.
- Ensure imports updated.

**PROMPT 9 ‚Äî Realtime contracts**
- Implement `types/realtime.ts` with message unions.
- Enforce usage in room channel.

**PROMPT 10 ‚Äî Ready/Start flow**
- Add ready toggle per participant.
- Implement `run_start` with 10s countdown.
- Ensure late joiners receive snapshot.

**PROMPT 11 ‚Äî Program engine**
- Implement `ProgramPanel` driven by program templates.
- Sync program step timing to run startAt.
- Provide 3 templates: Push-ups, Meditation, Wim Hof.

